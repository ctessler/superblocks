%
\clearpage
%
\section{Appendix}\label{sec:appendix}

To illustrate our approach for computing LCBs, consider the following example.  Assume we have two tasks, \begin{math}\tau_{1}\end{math} and \begin{math}\tau_{2}\end{math} with UCBs and ECBs for each listed in Figure~\ref{fig:taskset_ecbs_ucbs}.
\vspace{-5pt}
\begin{figure}[h!]
\begin{center}
\includegraphics[width=\linewidth]{taskset_ecbs_ucbs.png}
\caption{Taskset ECBs and UCBs.}
\label{fig:taskset_ecbs_ucbs}
\end{center}
\end{figure}
\vspace{-10pt}
\newline
\noindent
The computation for LCBs uses the accessed useful cache blocks (AUCBs) since the cache blocks that are re-loaded during execution of the non-preemptive region between preemption points is a function of the memory that is explicitly accessed by the preempted task.  The computed AUCBs for each task is shown in Figure~\ref{fig:taskset_aucbs}. In accordance with Equation~\ref{eqn:aucb-formula} one can readily see that the AUCBs are simply the intersection of the UCBs and ECBs for each basic block.
\vspace{-5pt}
\begin{figure}[h!]
\begin{center}
\includegraphics[width=\linewidth]{taskset_aucbs.png}
\caption{Taskset AUCBs.}
\label{fig:taskset_aucbs}
\end{center}
\end{figure}
\vspace{-10pt}
\newline
\noindent
In our example, assume preemptions are taken at basic blocks \begin{math}\delta_{1}^{2}\end{math} and \begin{math}\delta_{1}^{4}\end{math} for task \begin{math}\tau_{1}\end{math}. For simplicity, we calculate the LCBs associated with these two preemption points.  For $LCB(\delta_{1}^{2},\delta_{1}^{4})$, we have $UCB(\delta_{1}^{2})\ =\ \{1,2,4,8\}$.  The second expression is the set of memory that is accessed in basic blocks $\delta_{1}^{3}$ and $\delta_{1}^{4}$, namely $\{8\}\ \cup\ \{1,2,7,8\}\ =\ \{1,2,7,8\}$ comprising the set of AUCBs.  The third expression is the set of ECBs for task $\tau_{2}$ where $ECB(\tau_{2})\ =\ \{1,3,5,7,8,9,10,11,12,13\}$. Thus, $LCB(\delta_{1}^{2},\delta_{1}^{4})$ is given by the intersection of the three sets:
\begin{equation*}\label{eqn:lcb-example-1}
\begin{split}
    LCB(\delta_{1}^{2},\delta_{1}^{4}) = &\{1,2,4,8\}\ \cap\ \{1,2,7,8\}\ \cap\ \\&\{1,3,5,7,8,9,10,11,12,13\} = \{1,8\}
\end{split}
\end{equation*}
\newline
\noindent
The preemption cost $\gamma(\delta_{1}^{2},\delta_{1}^{4})$ for a BRT = $390\mu$s is given by:
\begin{equation*}\label{eqn:gamma-example-1}
    \gamma(\delta_{1}^{2},\delta_{1}^{4}) = |\{1,8\}|\ \cdot\ 390 = 780\mu\textit{s}
\end{equation*}
\newline
\noindent
Using the same method, $LCB(\delta_{1}^{4},\delta_{1}^{5})$ is given by:
\begin{equation*}\label{eqn:lcb-example-2}
\begin{split}
    LCB(\delta_{1}^{4},\delta_{1}^{5}) = &\{1,2,7,8\}\ \cap\ \{1,2,7,8\}\ \cap\ \\&\{1,3,5,7,8,9,10,11,12,13\} = \{1,7,8\}
\end{split}
\end{equation*}
\newline
\noindent
The preemption cost $\gamma(\delta_{1}^{4},\delta_{1}^{5})$ for a BRT = $390\mu$s is given by:
\begin{equation*}\label{eqn:gamma-example-1}
    \gamma(\delta_{1}^{4},\delta_{1}^{5}) = |\{1,7,8\}|\ \cdot\ 390 = 1170\mu\textit{s}
\end{equation*}
\newline
\noindent
Using the method illustrated here, the preemption cost matrix entries for each pair of basic blocks are computed in a similar fashion and used as input to our preemption point placement algorithm.
%
%\vspace{-20pt}
%\begin{figure}[h!]
%\begin{center}
%\includegraphics[width=\linewidth]{eps/recursion-icache.eps}
%\caption{Recursion Instruction Cache.}
%\label{fig:recursion_instruction_cache}
%\end{center}
%\end{figure}
%
%\vspace{-20pt}
%\begin{figure}[h!]
%\begin{center}
%\includegraphics[width=\linewidth]{eps/adpcm-dcache.eps}
%\caption{ADPCM Data Cache.}
%\label{fig:adpcm_data_cache}
%\end{center}
%\end{figure}
%
%\vspace{-20pt}
%\begin{figure}[h!]
%\begin{center}
%\includegraphics[width=\linewidth]{eps/adpcm-icache.eps}
%\caption{ADPCM Instruction Cache.}
%\label{fig:adpcm_instruction_cache}
%\end{center}
%\end{figure}
%
%\vspace{-20pt}
%\begin{figure}[h!]
%\begin{center}
%\includegraphics[width=\linewidth]{eps/bsort100-dcache.eps}
%\caption{BSORT100 Data Cache.}
%\label{fig:bsort100_data_cache}
%\end{center}
%\end{figure}
%
%\vspace{-20pt}
%\begin{figure}[h!]
%\begin{center}
%\includegraphics[width=\linewidth]{eps/bsort100-icache.eps}
%\caption{BSORT100 Instruction Cache.}
%\label{fig:bsort100_instruction_cache}
%\end{center}
%\end{figure}
%
%\vspace{-20pt}
%\begin{figure}[h!]
%\begin{center}
%\includegraphics[width=\linewidth]{eps/cnt-dcache.eps}
%\caption{CNT Data Cache.}
%\label{fig:cnt_data_cache}
%\end{center}
%\end{figure}
%
%\vspace{-20pt}
%\begin{figure}[h!]
%\begin{center}
%\includegraphics[width=\linewidth]{eps/cnt-icache.eps}
%\caption{CNT Instruction Cache.}
%\label{fig:cnt_instruction_cache}
%\end{center}
%\end{figure}
%
%\vspace{-20pt}
%\begin{figure}[h!]
%\begin{center}
%\includegraphics[width=\linewidth]{eps/cover-dcache.eps}
%\caption{Cover Data Cache.}
%\label{fig:cover_data_cache}
%\end{center}
%\end{figure}
%
%\vspace{-20pt}
%\begin{figure}[h!]
%\begin{center}
%\includegraphics[width=\linewidth]{eps/cover-icache.eps}
%\caption{Cover Instruction Cache.}
%\label{fig:cover_instruction_cache}
%\end{center}
%\end{figure}
%
%\vspace{-20pt}
%\begin{figure}[h!]
%\begin{center}
%\includegraphics[width=\linewidth]{eps/crc-dcache.eps}
%\caption{CRC Data Cache.}
%\label{fig:crc_data_cache}
%\end{center}
%\end{figure}
%
%\vspace{-20pt}
%\begin{figure}[h!]
%\begin{center}
%\includegraphics[width=\linewidth]{eps/crc-icache.eps}
%\caption{CRC Instruction Cache.}
%\label{fig:crc_instruction_cache}
%\end{center}
%\end{figure}
%
%\vspace{-20pt}
%\begin{figure}[h!]
%\begin{center}
%\includegraphics[width=\linewidth]{eps/fft1-dcache.eps}
%\caption{FFT1 Data Cache.}
%\label{fig:fft1_data_cache}
%\end{center}
%\end{figure}
%
%\vspace{-20pt}
%\begin{figure}[h!]
%\begin{center}
%\includegraphics[width=\linewidth]{eps/fft1-icache.eps}
%\caption{FFT1 Instruction Cache.}
%\label{fig:fft1_instruction_cache}
%\end{center}
%\end{figure}
%
%\vspace{-20pt}
%\begin{figure}[h!]
%\begin{center}
%\includegraphics[width=\linewidth]{eps/fibcall-dcache.eps}
%\caption{Fibcall Data Cache.}
%\label{fig:fibcall_data_cache}
%\end{center}
%\end{figure}
%
%\vspace{-20pt}
%\begin{figure}[h!]
%\begin{center}
%\includegraphics[width=\linewidth]{eps/fibcall-icache.eps}
%\caption{Fibcall Instruction Cache.}
%\label{fig:fibcall_instruction_cache}
%\end{center}
%\end{figure}
%
%\begin{figure}[h!]
%\vspace{-20pt}
%\begin{center}
%\includegraphics[width=\linewidth]{eps/lms-icache.eps}
%\caption{LMS Instruction Cache.}
%\label{fig:lms_instruction_cache}
%\end{center}
%\vspace{-10pt}
%\end{figure}
%
%\vspace{-20pt}
%\begin{figure}[h!]
%\begin{center}
%\includegraphics[width=\linewidth]{eps/ndes-dcache.eps}
%\caption{NDES Data Cache.}
%\label{fig:ndes_data_cache}
%\end{center}
%\end{figure}
%
%\vspace{-20pt}
%\begin{figure}[h!]
%\begin{center}
%\includegraphics[width=\linewidth]{eps/ndes-icache.eps}
%\caption{NDES Instruction Cache.}
%\label{fig:ndes_instruction_cache}
%\end{center}
%\end{figure}
% 
%
% BEGIN:2015-01-31 CT
%

Figure~\ref{fig:test} illustrates the necessary inclusion of
${\delta_i^{N_i}}$. A four basic block of task ${\tau_2}$
may be preempted by ${\tau_1}$. To simplify the example, the
ECBs of ${\tau_1}$ includes all cache lines. When ${\rho_2 =
  \{\delta_2^0, \delta_2^1\}}$, only reloaded lines from
${LCB(\delta_2^0, \delta_2^1)}$ contribute to
${C_2}$. However, ${\delta_2^2}$ accesses cache line 3 which may have
been present before ${\delta_2^0}$ was preempted. By requiring the
inclusion of ${\delta_2^3}$ in ${\rho_2}$ cache line 3 will be
accounted for by ${LCB(\delta_2^1, \delta_2^3)}$. Similarly, the
requirement of ${\delta_2^0}$ in ${\rho_2}$ assures no reloaded cache
line is omitted in the calculation of ${C_2}$.

\begin{figure}[!htb]
  \centering
  \def\svgwidth{250pt}
  \input{ink/lcb_01.pdf_tex}
  \vspace{5pt}
  \caption{LCB Example}
  \label{fig:test}
\end{figure}

%
% END:2015-01-31 CT
%
